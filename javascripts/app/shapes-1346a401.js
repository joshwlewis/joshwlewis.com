function shapes_grid(t,s,e,h){return this.max_diameter=s,this.rows=h,this.columns=e,this.shape_colors=["#C00","#0C0","#00C"],this.shadow_color="#999",this.letter_color="#FFF",this.letters=[],this.spacing=1.2*s,this.side_counts=[1,3,4,5,6],this.shapes=[],this.shrinking_shapes=[],this.growing_shapes=[],this.step=0,this.speed=1,this.font="Courier",this.change_ratio=function(){return 2*this.max_diameter/((this.columns-1)*(this.rows-1)*this.speed)},this.interval=function(){return this.change_ratio()>=1?2*Math.ceil(this.change_ratio()):2},this.letter_for=function(t,i){return letter_obj=this.letters.filter(function(s){return s.c==t&&s.r==i})[0],void 0!=letter_obj?letter_obj.letter:void 0},this.init=function(){for(var t=1;t<=this.columns;t++)for(var i=1;i<=this.rows;i++)this.shapes.push(new grid_shape(this,t,i,0,this.side_counts.sample(),this.shape_colors.sample(),this.letter_for(t,i)))},this.full_shapes=function(){return this.shapes.filter(function(t){return t.diameter==s})},this.zero_shapes=function(){return this.shapes.filter(function(t){return 0==t.diameter})},this.zero_shrinking_shapes=function(){return this.shrinking_shapes.filter(function(t){return 0==t.diameter})},this.full_growing_shapes=function(){return this.growing_shapes.filter(function(t){return t.diameter>=s})},this.add_shrinking_shape=function(){new_shrinker=this.full_shapes().sample(),void 0!=new_shrinker&&this.shrinking_shapes.push(new_shrinker)},this.remove_zero_shrinking_shapes=function(){for(i=0;i<this.zero_shrinking_shapes().length;i++)this.shrinking_shapes.remove(this.zero_shrinking_shapes()[i])},this.add_growing_shape=function(){new_grower=this.zero_shapes().sample(),void 0!=new_grower&&this.growing_shapes.push(new_grower)},this.grow_shapes=function(){for(i=0;i<this.growing_shapes.length;i++)this.growing_shapes[i].diameter+=this.speed},this.shrink_shapes=function(){for(i=0;i<this.shrinking_shapes.length;i++)this.shrinking_shapes[i].diameter-=this.speed},this.remove_full_growing_shapes=function(){for(i=0;i<this.full_growing_shapes().length;i++)this.growing_shapes.remove(this.full_growing_shapes()[i])},this.reset_zero_shapes=function(){for(i=0;i<this.zero_shapes().length;i++)this.zero_shapes()[i].sides=this.side_counts.sample(),this.zero_shapes()[i].color=this.shape_colors.sample()},this.increment=function(){++this.step,this.remove_zero_shrinking_shapes(),this.remove_full_growing_shapes(),this.step%this.interval()==0&&this.add_shrinking_shape(),this.reset_zero_shapes(),this.add_growing_shape(),this.shrink_shapes(),this.grow_shapes()},this.clear=function(){t.clearRect(0,0,t.canvas.width,t.canvas.height)},this.draw=function(){for(var t=0;t<this.shapes.length;t++)this.shapes[t].draw()},this}function animate(){for(reqAnimFrame=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,reqAnimFrame(animate),i=0;i<animations.length;i++)animation=animations[i],animation.increment(),animation.clear(),animation.draw()}function grid_shape(t,i,s,e,h,n,r){this.grid=t,this.column=i,this.row=s,this.diameter=e,this.sides=h,this.color=n,this.letter=r,this.radius=function(){return this.diameter/2},this.x=function(){return(this.column-.5)*this.grid.spacing},this.y=function(){return(this.row-.5)*this.grid.spacing},this.angle=function(){switch(this.sides){case 3:return 1.5*Math.PI;case 4:return.25*Math.PI;case 5:return.5*Math.PI;case 8:return.125*Math.PI;default:return 0}},this.draw=function(){if(context.save(),context.beginPath(),1==this.sides)context.arc(this.x(),this.y(),this.radius(),0,2*Math.PI,!1);else{context.moveTo(this.x()+this.radius()*Math.cos(this.angle()),this.y()+this.radius()*Math.sin(this.angle()));for(var t=1;t<=this.sides;t++)context.lineTo(this.x()+this.radius()*Math.cos(this.angle()+2*t*Math.PI/this.sides),this.y()+this.radius()*Math.sin(this.angle()+2*t*Math.PI/this.sides))}context.closePath(),context.shadowBlur=this.diameter/4,context.shadowOffsetX=this.diameter/8,context.shadowOffsetY=this.diameter/8,context.shadowColor=this.grid.shadow_color,context.fillStyle=this.color,context.fill(),context.restore(),void 0!=this.letter&&(context.font="".concat(.5*this.diameter).concat("px ").concat(this.grid.font),context.textAlign="center",context.textBaseline="middle",context.fillStyle=this.grid.letter_color,context.fillText(this.letter,this.x(),this.y()))}}var animations=[];Array.prototype.sample=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.remove=function(){for(var t,i,s=arguments,e=s.length;e&&this.length;)for(t=s[--e];-1!==(i=this.indexOf(t));)this.splice(i,1);return this};